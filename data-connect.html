<!DOCTYPE html>
<html>
<head>
  <meta charSet='utf-8' />
  <title>Relate docs - Data Connect</title>
  <link rel='icon' type='image/png' href='/relate/images/logo.png' />
  <link href='/relate/css/bootstrap.min.css' rel='stylesheet'>
  <link href='/relate/css/docs.css' rel='stylesheet'>
  <link href='/relate/css/font-awesome.min.css' rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,300,700' rel='stylesheet' type='text/css'>
</head>
<body>
  <div class='menu'>
    <div class='logo'>
      <img src='/relate/images/logo.png' />
      <span>Relate.js</span>
    </div>
    <nav class='menu-nav'>
      
        <ul class='nav'>
          <span>Introduction</span>
          <ul class='nav'>
            
              <li>
                <a href='/relate/index.html'>What is relate</a>
              </li>
            
              <li>
                <a href='/relate/how-it-works.html'>How it works</a>
              </li>
            
          </ul>
        </ul>
      
        <ul class='nav'>
          <span>Usage</span>
          <ul class='nav'>
            
              <li>
                <a href='/relate/installation.html'>Installation</a>
              </li>
            
              <li>
                <a href='/relate/reducer.html'>Reducer</a>
              </li>
            
              <li>
                <a href='/relate/root-data-connect.html'>Root data connect</a>
              </li>
            
              <li>
                <a href='/relate/fragments.html'>Fragments</a>
              </li>
            
              <li>
                <a href='/relate/data-connect.html' class='active'>Data connect</a>
              </li>
            
              <li>
                <a href='/relate/mutations.html'>Mutations</a>
              </li>
            
          </ul>
        </ul>
      
        <ul class='nav'>
          <span>Advanced Usage</span>
          <ul class='nav'>
            
              <li>
                <a href='/relate/intersect.html'>Catch queries or mutations in other reducers</a>
              </li>
            
          </ul>
        </ul>
      
    </nav>
    <a class='footer' href='https://github.com/relax/relate'>
      <i class='fa fa-github'></i>
      <span>Project on github</span>
    </a>
  </div>
  <div class='page'>
    <div class='page-content'>
      <h1>Data Connect</h1>
      <p>Data connect is where all the fancy stuff happens. Relate’s <code>dataConnect</code> is an extension of React Redux’s <code>connect</code>, so it has the following parameters:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataConnect([mapStateToProps], [mapDispatchToProps], [RelateConfig])</span><br></pre></td></tr></table></figure>
<p>If you don’t want to map anything from the state and the dispatch, you also just:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataConnect([RelateConfig])</span><br></pre></td></tr></table></figure>
<p>Relate handles the fragments you requested from the server automatically into the wrapped component props so you don’t need to fetch nothing from the Relate’s reducer.</p>
<p>Let’s see an example on how to configure our <code>dataConnect</code> to fetch a list of pages:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;PropTypes, Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;dataConnect&#125; <span class="keyword">from</span> <span class="string">'relate-js'</span>;</span><br><span class="line"></span><br><span class="line">@dataConnect(</span><br><span class="line">  (state) =&gt; (&#123;</span><br><span class="line">    sort: state.router.location.query.sort || <span class="string">'_id'</span>,</span><br><span class="line">    order: state.router.location.query.order || <span class="string">'desc'</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="literal">null</span>,</span><br><span class="line">  (props) =&gt; (&#123;</span><br><span class="line">    fragments: &#123;</span><br><span class="line">      pages: &#123;</span><br><span class="line">        _id: <span class="number">1</span>,</span><br><span class="line">        title: <span class="number">1</span>,</span><br><span class="line">        state: <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    variablesTypes: &#123;</span><br><span class="line">      pages: &#123;</span><br><span class="line">        sort: <span class="string">'String'</span>,</span><br><span class="line">        order: <span class="string">'String'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    initialVariables: &#123;</span><br><span class="line">      pages: &#123;</span><br><span class="line">        sort: props.sort,</span><br><span class="line">        order: props.order</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">      addPage: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'PREPEND'</span>,</span><br><span class="line">          field: <span class="string">'pages'</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">PagesContainer</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    pages: PropTypes.array,</span><br><span class="line">    sort: PropTypes.string.isRequired,</span><br><span class="line">    order: PropTypes.string.isRequired,</span><br><span class="line">    loading: PropTypes.bool.isRequired</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    pages: []</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  componentWillReceiveProps (nextProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nextProps.sort !== <span class="keyword">this</span>.props.sort || nextProps.order !== <span class="keyword">this</span>.props.order) &#123;</span><br><span class="line">      <span class="keyword">this</span>.props.relate.setVariables(&#123;</span><br><span class="line">        pages: &#123;</span><br><span class="line">          sort: nextProps.sort,</span><br><span class="line">          order: nextProps.order</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">let</span> result;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.loading) &#123;</span><br><span class="line">      result = (</span><br><span class="line">        &lt;div&gt;loading&lt;/div&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result = (</span><br><span class="line">        &lt;div&gt; ... &lt;/div&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The example is a bit extensive to show every part of it. Let’s go through what’s happening in the <code>dataConnect</code> first. The first two arguments are related to Redux React <code>connect</code>. First we fetch two values from the state that we’ll use to add as variables in our query. The second is the dispatch map, since we’ll not use none, it’s set <code>null</code>.</p>
<p>Now the special part comes in the third argument of <code>dataConnect</code> where we have:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">(props) =&gt; (&#123;</span><br><span class="line">  fragments: &#123;</span><br><span class="line">    pages: &#123;</span><br><span class="line">      _id: <span class="number">1</span>,</span><br><span class="line">      title: <span class="number">1</span>,</span><br><span class="line">      state: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  variablesTypes: &#123;</span><br><span class="line">    pages: &#123;</span><br><span class="line">      sort: <span class="string">'String'</span>,</span><br><span class="line">      order: <span class="string">'String'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  initialVariables: &#123;</span><br><span class="line">    pages: &#123;</span><br><span class="line">      sort: props.sort,</span><br><span class="line">      order: props.order</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    addPage: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'PREPEND'</span>,</span><br><span class="line">        field: <span class="string">'pages'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>This is where we “tell” Relate the data dependencies of this container.</p>
<h2 id="Fragments"><a href="#Fragments" class="headerlink" title="Fragments"></a>Fragments</h2><p>So, first thing to do is define the <code>fragments</code>. Usually these come from a presentational component static fragments that your container renders, but to keep it simple we’ve put it directly here. With these fragments we’re requesting <code>pages</code> with a set of fields but we want to send some variables to the query as well.</p>
<h2 id="Variables-Types"><a href="#Variables-Types" class="headerlink" title="Variables Types"></a>Variables Types</h2><p>To include variables, we first need to define which types of variables we’ll be sending. This is done in the <code>variablesTypes</code>, you can specify here every variables types it can have, even if you don’t include them. You can also define some as mandatory like the following:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">variablesTypes: &#123;</span><br><span class="line">  pages: &#123;</span><br><span class="line">    sort: <span class="string">'String!'</span>,</span><br><span class="line">    order: <span class="string">'String!'</span>,</span><br><span class="line">    search: <span class="string">'String'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the above we’re defining that when querying for pages there needs to be a <code>sort</code> and <code>order</code> variables, and an optional <code>search</code> one. If you’re familiar with GraphQL this should be pretty straightforward.</p>
<h2 id="Initial-Variables"><a href="#Initial-Variables" class="headerlink" title="Initial Variables"></a>Initial Variables</h2><p>Now we’re just missing how to set this variables. This is done in the <code>initialVariables</code> property, and since we have access to the props (including the ones mapped from redux state) we can define them based on them, thus:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">initialVariables: &#123;</span><br><span class="line">  pages: &#123;</span><br><span class="line">    sort: props.sort,</span><br><span class="line">    order: props.order</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Relate will use this variables to calculate the initial query variables. You can set variables mid component’s lifecycle, but we’ll get to that in a bit.</p>
<h2 id="Mutations"><a href="#Mutations" class="headerlink" title="Mutations"></a>Mutations</h2><p>Since we’re defining an <code>_id</code> in our <code>pages</code> fragments, Relate will take them as nodes. Any update or change to that node will automatically be reflected in this list. So for example, if in a component far far away we make a mutation to node with the same <code>_id</code> as one of the ones included in the list of pages retrieved here. The list will be updated to reflect that change. Pretty huh? Let’s see an example, if the result from this query to pages we receive the following:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="string">'a'</span>,</span><br><span class="line">    title: <span class="string">'Page A'</span>,</span><br><span class="line">    state: <span class="string">'draft'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="string">'b'</span>,</span><br><span class="line">    title: <span class="string">'Page B'</span>,</span><br><span class="line">    state: <span class="string">'draft'</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>If in some mutation, for example, <code>updatePageState</code> we mutate the page with <code>_id</code> b and set state to published. This list will be updated to reflect that change:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="string">'a'</span>,</span><br><span class="line">    title: <span class="string">'Page A'</span>,</span><br><span class="line">    state: <span class="string">'draft'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="string">'b'</span>,</span><br><span class="line">    title: <span class="string">'Page B'</span>,</span><br><span class="line">    state: <span class="string">'published'</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Pretty cool, what about removes? Removes are also automatically handled by Relate. If some remove mutation is done to a page that is in this list, the list will be updated as well.</p>
<p>Now only missing adds right? Since Relate is agnostic to your data schema it can’t really know that an <code>addPage</code> result should come into this list. And shouldn’t you be in charge on where to add it? So, for this you can configure a mutations property:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  addPage: [</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">'PREPEND'</span>,</span><br><span class="line">      field: <span class="string">'pages'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>What’s happening here? We’re telling Relate than when a mutation <code>addPage</code> is triggered it should prepend it to this container’s <code>pages</code> field. This has its advantages since we can make something like the following:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  addPage: [</span><br><span class="line">    &#123;</span><br><span class="line">      type: props.order === <span class="string">'asc'</span> ? <span class="string">'PREPEND'</span> : <span class="string">'APPEND'</span>,</span><br><span class="line">      field: <span class="string">'pages'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can make one of the following operations types:</p>
<ul>
<li><strong>PREPEND</strong> - prepends an entry or an array of entries to a list.</li>
<li><strong>APPEND</strong> - appends an entry or an array of entries to a list.</li>
<li><strong>INCREMENT</strong> - increments a number.</li>
<li><strong>DECREMENT</strong> - increments a number.</li>
</ul>
<p>So for example, if we have a pagesCount in our fragments as well, we can set an increment operation for it:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  addPage: [</span><br><span class="line">    &#123;</span><br><span class="line">      type: props.order === <span class="string">'asc'</span> ? <span class="string">'PREPEND'</span> : <span class="string">'APPEND'</span>,</span><br><span class="line">      field: <span class="string">'pages'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">'INCREMENT'</span>,</span><br><span class="line">      field: <span class="string">'pagesCount'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Relate-Props"><a href="#Relate-Props" class="headerlink" title="Relate Props"></a>Relate Props</h2><p>We might want to update something during the component lifecycle, being if some new props arrived or from an user interaction. When you use <code>dataConnect</code> your wrapped component will receive the following as props from relate:</p>
<ul>
<li><strong>loading</strong> - boolean value, true when your container is waiting for data.</li>
<li><strong>relate</strong> - an object containing the following:<ul>
<li><strong>setVariables</strong> - function for setting new variables</li>
<li><strong>variables</strong> - the current in use variables</li>
</ul>
</li>
</ul>
<p>We can use the loading prop to set a loading state as we have in the render function:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">render () &#123;</span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.props.loading) &#123;</span><br><span class="line">    result = (</span><br><span class="line">      &lt;div&gt;loading&lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result = (</span><br><span class="line">      &lt;div&gt; ... &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>When <code>loading</code> is set to false, your data was received and processed so you can render in this example’s case the pages list.</p>
<p>You can also use <code>setVariables</code> to trigger a new fetch with different variables for your connector. In this example we do this when the prop <code>order</code> or <code>sort</code> has changed:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">componentWillReceiveProps (nextProps) &#123;</span><br><span class="line">  <span class="keyword">if</span> (nextProps.sort !== <span class="keyword">this</span>.props.sort || nextProps.order !== <span class="keyword">this</span>.props.order) &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.relate.setVariables(&#123;</span><br><span class="line">      pages: &#123;</span><br><span class="line">        sort: nextProps.sort,</span><br><span class="line">        order: nextProps.order</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>That’s all for the data connect. Let’s see how to make Relate mutations in the next page.</p>

    </div>
  </div>
  <div class='switch-page'>
    
      <a class='previous' href='/relate/fragments.html'>
        <i class='fa fa-angle-left'></i>
        <span>Previous</span>
      </a>
    
    
      <a class='next' href='/relate/mutations.html'>
        <span>Next</span>
        <i class='fa fa-angle-right'></i>
      </a>
    
  </div>
</body>
</html>
